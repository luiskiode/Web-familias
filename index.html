<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ğŸ“Œ CÃ¡ritas CNC</title>

<!-- Estilos -->
<link rel="stylesheet" href="styles.css?v=10" />

<!-- FullCalendar -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js" defer></script>

<!-- Leaflet (mapas) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>

<!-- QR -->
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js" defer></script>

<!-- Manifest -->
<link rel="manifest" href="manifest.json" />

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js" defer></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js" defer></script>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
<script src="./supabase-config.js" defer></script>
</head>
<body>

<!-- Video de fondo -->
<video autoplay muted loop playsinline id="video-fondo">
  <source src="fondo-rojo.mp4" type="video/mp4">
  Tu navegador no soporta video en HTML5.
</video>

<!-- Header -->
<header class="app-header">
  <h1 id="appTitle">ğŸ“Œ CÃ¡ritas CNC</h1>
  <nav>
    <button onclick="mostrarSeccion('inicio')">ğŸ  Inicio</button>
    <button id="btnRegistro" onclick="mostrarSeccion('registro-fam')">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Registro Familias</button>
    <button id="btnServicios" onclick="mostrarSeccion('servicios')" style="display:none;">âš™ï¸ Servicios</button>
    <button id="btnLogout" style="display:none;">ğŸ”’ Cerrar sesiÃ³n</button>
  </nav>
</header>

<!-- SecciÃ³n Inicio -->
  <section id="inicio" class="seccion active">
     <div class="inicio-card">
       <div class="inicio-contenido"> 
        <h2 id="bienvenida">ğŸ‘‹ bienvenida a CÃ¡ritas CNC â¤ï¸</h2> 
        <p id="mensajeInicio"> Esta es la plataforma de gestiÃ³n para el voluntariado de CÃ¡ritas CNC.
          <br> Desde aquÃ­ puedes registrar nuevas familias, gestionar tareas internas y acceder a la agenda del grupo. </p> 
          <div class="pendientes-bloque"> <h3>ğŸ“Œ Resumen de pendientes</h3>
             <p id="pendientesTexto">Los pendientes son: (sin pendientes aÃºn)</p> 
             <button class="btn-peque" onclick="mostrarSeccion('servicios')">Ver mÃ¡s â</button> 
            </div> <div class="quick-actions"> <button class="btn-peque" onclick="alert('ğŸ‘‰ SecciÃ³n de donaciones prÃ³ximamente')">ğŸ’– Donaciones</button>
             <button class="btn-peque" onclick="alert('ğŸ‘‰ SecciÃ³n de patrocinio prÃ³ximamente')">ğŸ¤ Patrocinio</button> 
            </div> <div class="mision-vision"> <div class="mision">
               <h3>ğŸŒŸ Nuestra MisiÃ³n</h3> <ul> <li>ğŸ’– Servir con amor, respeto y empatÃ­a a las familias mÃ¡s necesitadas.</li> 
                <li>ğŸ™ Guiarnos por la fe, el compromiso y la compasiÃ³n.</li>
                 <li>ğŸ¤ Promover dignidad, justicia y solidaridad.</li>
                  <li>ğŸŒ± Trabajar unidos para crear oportunidades de desarrollo y esperanza.</li>
                   <li>ğŸ”¥ Transformar vidas a travÃ©s de la acciÃ³n social y el amor al prÃ³jimo.</li> </ul>
                   </div> <div class="vision"> <h3>ğŸš€ Nuestra VisiÃ³n</h3> <ul>
                     <li>ğŸ› Ser un referente de servicio y apoyo a familias vulnerables.</li>
                      <li>ğŸ’¡ Construir una comunidad justa, fraterna y solidaria.</li>
                       <li>âœ Inspirarnos en el Evangelio para transformar realidades.</li> 
                       <li>ğŸŒ Promover justicia social y desarrollo integral de cada persona.</li>
                        <li>ğŸ¤— AcompaÃ±ar a cada familia para que encuentre un lugar de acogida y transformaciÃ³n.</li> </ul>
                       </div> <p class="agradecimiento">ğŸ™ Â¡Gracias por ser parte de esta misiÃ³n!</p> 
                       <p class="agradecimiento"><b>Gracias por usar CÃ¡ritas CNC</b>
                      </p> </div> <!-- GalerÃ­a lateral --> <div class="galeria">
                         <h3>ğŸ“· Nuestra comunidad</h3> <div class="galeria-grid">
                           <img src="img/imagen de grupo 1.jpeg" alt="Imagen 1" class="miniatura"> <img src="img/imagen de grupo 2.jpeg" alt="Imagen 2" class="miniatura"> <img src="img/imagen de grupo 3.jpeg" alt="Imagen 3" class="miniatura"> <img src="img/imagen de grupo 4.jpeg" alt="Imagen 4" class="miniatura"> <img src="img/imagen de grupo 5.jpeg" alt="Imagen 5" class="miniatura"> </div> </div> </div> </div> </section> <!-- Modal galerÃ­a --> <div id="modal" class="modal"> <span class="cerrar">&times;</span> <img class="modal-contenido" id="img-ampliada"> <div id="caption"></div> </div>

<!-- Registro Familias -->
<section id="registro-fam" class="seccion">
  <h2>ğŸ“‹ Registro de Familias</h2>
  <form id="familiaForm" class="card">
    <label>Nombres y Apellidos*</label>
    <input type="text" name="nombres_apellidos" required />
    <label>DNI*</label>
    <input type="text" name="dni_solicitante" maxlength="8" pattern="[0-9]{8}" required />
    <label>Apellido Familia*</label>
    <input type="text" name="apellido_familia" required />
    <label>DirecciÃ³n*</label>
    <div style="display:flex; gap:0.5rem;">
      <input type="text" id="reg-direccion" name="direccion" required />
      <button type="button" onclick="abrirMapa()">ğŸ“ Validar</button>
    </div>
    <label>Fecha de Registro*</label>
    <input type="date" name="fecha_registro" required />
    <label>TelÃ©fono*</label>
    <input type="text" name="telefono_contacto" pattern="[0-9]+" required />
    <label>Observaciones</label>
    <textarea name="observaciones"></textarea>
    <label>Adjuntar documento</label>
    <input type="file" name="archivo" accept=".pdf,.jpg,.png" />
    <label><input type="checkbox" required> Acepto los <a href="terminos.html" target="_blank">tÃ©rminos</a></label>
    <button type="submit">Guardar Familia</button>
  </form>
</section>

<!-- Servicios -->
<section id="servicios" class="seccion">
  <h2>âš™ï¸ Servicios</h2>
  <div id="loginCard" class="card">
    <h3>ğŸ”‘ Iniciar SesiÃ³n</h3>
    <input type="email" id="login-email" placeholder="Correo" required />
    <input type="password" id="login-password" placeholder="ContraseÃ±a" required />
    <button id="btn-login">Iniciar SesiÃ³n</button>
  </div>

  <div id="serviciosGrid" style="display:none;">
    <div class="servicio-card">
      <h3>ğŸªª Credenciales</h3>
      <form id="credencialForm">
        <input type="email" id="email" placeholder="Correo*" required />
        <input type="password" id="password" placeholder="ContraseÃ±a*" required />
        <input type="file" id="foto" accept="image/*" required />
        <button type="submit">Generar Credencial</button>
      </form>
      <div id="credencialPreview"></div>
    </div>

    <div class="servicio-card">
      <h3>ğŸ“… Calendario</h3>
      <div id="calendar"></div>
    </div>

    <div class="servicio-card">
      <h3>ğŸ“‹ Pendientes</h3>
      <form id="pendienteForm">
        <input type="text" id="pendienteInput" placeholder="Escribe un pendiente..." required />
        <button type="submit">â• Agregar</button>
      </form>
      <ul id="pendientesList"></ul>
    </div>
  </div>
</section>

<script defer>
document.addEventListener("DOMContentLoaded", () => {

  // === Firebase ===
  const firebaseConfig = {
    apiKey: "AIzaSyD5X6LUG_dOwuaUf6jQUHw_LM5PFgOmc40",
    authDomain: "web-familias.firebaseapp.com",
    projectId: "web-familias",
    storageBucket: "web-familias.firebasestorage.app",
    messagingSenderId: "261699620792",
    appId: "1:261699620792:web:8ff59afb72e96c371dc94d"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  const btnLogout = document.getElementById("btnLogout");
  const btnServicios = document.getElementById("btnServicios");
  const serviciosGrid = document.getElementById("serviciosGrid");
  const loginCard = document.getElementById("loginCard");
  const bienvenida = document.getElementById("bienvenida");
  const mensajeInicio = document.getElementById("mensajeInicio");
  const appTitle = document.getElementById("appTitle");

  // Observador de sesiÃ³n
  auth.onAuthStateChanged(user => {
    if(user){
      bienvenida.textContent = `ğŸ‘‹ Bienvenid@, ${user.email}`;
      mensajeInicio.textContent = "Desde aqui puedes ver todo el contenido exclusivo para ti.";
      btnLogout.style.display = "inline-block";
      btnServicios.style.display = "inline-block";
      loginCard.style.display = "none";
      serviciosGrid.style.display = "grid";
    } else {
      bienvenida.textContent = "ğŸ‘‹ Bienvenid@ a CÃ¡ritas CNC";
      mensajeInicio.textContent = "Desde aquÃ­ puedes registrar nuevas familias, gestionar tareas internas y acceder a la agenda del grupo.";
      btnLogout.style.display = "none";
      btnServicios.style.display = "none";
      loginCard.style.display = "block";
      serviciosGrid.style.display = "none";
    }
  });

  // Login
  document.getElementById("btn-login").addEventListener("click", async () => {
    const email = document.getElementById("login-email").value;
    const password = document.getElementById("login-password").value;
    try{
      await auth.signInWithEmailAndPassword(email,password);
      alert("âœ… SesiÃ³n iniciada con Ã©xito");
      loginCard.style.display="none";
      serviciosGrid.style.display="grid";
    }catch(err){
      alert("âŒ Error al iniciar sesiÃ³n: "+err.message);
    }
  });

  // Logout
  btnLogout.addEventListener("click", async ()=>{
    try{
      await auth.signOut();
      alert("âœ… SesiÃ³n cerrada");
      mostrarSeccion("inicio");
    }catch(err){console.error(err);}
  });

  // Click en tÃ­tulo abre login
  appTitle.addEventListener("click", ()=>{
    mostrarSeccion("servicios");
    if(!auth.currentUser){
      loginCard.style.display="block";
      serviciosGrid.style.display="none";
    }
    document.getElementById("login-email").focus();
  });

  // Mostrar secciÃ³n
  window.mostrarSeccion = function(id){
    const sec = document.getElementById(id);
    if(!sec) return console.error("SecciÃ³n no encontrada:", id);
    document.querySelectorAll(".seccion").forEach(s=>s.classList.remove("active"));
    sec.classList.add("active");
  };

  // Abrir mapa
  window.abrirMapa = function(){
    const dir = document.getElementById("reg-direccion").value.trim();
    const url = dir ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(dir)}` : "https://www.google.com/maps/";
    window.open(url,"_blank");
  };

});
</script>

<!-- Scripts externos (deben usar defer) -->
<script src="./login-supabase.js" defer></script>
<script src="./credenciales.js" defer></script>
<script src="./familias.js" defer></script>
<script src="./servicios.js" defer></script>
<script src="./calendario.js" defer></script>
<script src="./pendientes.js" defer></script>

</body>
</html>
