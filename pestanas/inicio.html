<section class="inicio-card" id="tab-inicio">
  <!-- ğŸ“ Mensaje semanal -->
  <article class="card" id="mensaje-semanal">
    <h3 class="with-emoji" data-emoji="ğŸ“">Mensaje Semanal</h3>
    <p>
      âœ¨ <strong>Querido Voluntario</strong>, la caridad es paciente, la caridad es
      benigna; no es envidiosa, no obra con soberbia, no se jacta, no es ambiciosa,
      no busca lo suyo, no se irrita, no toma en cuenta el mal, no se alegra por la
      injusticia, se complace con la verdad; todo lo aguanta, todo lo cree, todo lo
      espera, todo lo soporta. ğŸ™ Rezo por ello; y ustedes tambiÃ©n, por favor, recen
      por mÃ­. â¤ï¸â€ğŸ”¥
    </p>
  </article>

  <!-- ğŸ“Œ Pendientes (solo lectura) -->
  <article class="card">
    <header style="display:flex;align-items:center;justify-content:space-between;gap:.5rem;">
      <h3>ğŸ“Œ Mis pendientes</h3>
      <small class="pill">vista solo lectura</small>
    </header>
    <div id="pendientes-home-empty" class="muted" hidden>
      Sin pendientes aÃºn. âœ¨
    </div>
    <table aria-label="Tabla de pendientes">
      <thead>
        <tr><th scope="col">Tarea</th><th scope="col" style="width:120px">Estado</th></tr>
      </thead>
      <tbody id="pendientesHomeBody"></tbody>
    </table>
  </article>

  <!-- ğŸŒŸ MisiÃ³n / ğŸš€ VisiÃ³n -->
  <article class="card mision-vision">
    <div class="mision">
      <h3>ğŸŒŸ Nuestra MisiÃ³n</h3>
      <ul>
        <li>â¤ï¸ Servir con respeto y empatÃ­a a las familias mÃ¡s necesitadas.</li>
        <li>ğŸ™ Guiarnos por la fe, el compromiso y la compasiÃ³n.</li>
        <li>ğŸ¤ Promover dignidad, justicia y solidaridad.</li>
        <li>ğŸŒ± Trabajar unidos para crear oportunidades y esperanza.</li>
        <li>ğŸ”¥ Transformar vidas a travÃ©s de la acciÃ³n social.</li>
      </ul>
    </div>
    <div class="vision">
      <h3>ğŸš€ Nuestra VisiÃ³n</h3>
      <ul>
        <li>ğŸ› Ser referente de servicio y apoyo.</li>
        <li>ğŸ’¡ Construir una comunidad fraterna.</li>
        <li>âœ Inspirarnos en el Evangelio.</li>
        <li>ğŸŒ Promover justicia social y desarrollo integral.</li>
        <li>ğŸ¤— AcompaÃ±ar con acogida y transformaciÃ³n.</li>
      </ul>
    </div>
    <p class="agradecimiento">ğŸ™ Â¡Gracias por ser parte de esta misiÃ³n! â¤ï¸</p>
  </article>

  <!-- ğŸ“· GalerÃ­a -->
  <article class="card">
    <h3>ğŸ“· Nuestra comunidad</h3>
    <div class="galeria-grid">
      <img src="img/imagen de grupo 1.jpeg" alt="Grupo 1 de voluntarios" class="miniatura" loading="lazy"/>
      <img src="img/imagen de grupo 2.jpeg" alt="Grupo 2 de voluntarios" class="miniatura" loading="lazy"/>
      <img src="img/imagen de grupo 3.jpeg" alt="Grupo 3 de voluntarios" class="miniatura" loading="lazy"/>
      <img src="img/imagen de grupo 4.jpeg" alt="Grupo 4 de voluntarios" class="miniatura" loading="lazy"/>
      <img src="img/imagen de grupo 5.jpeg" alt="Grupo 5 de voluntarios" class="miniatura" loading="lazy"/>
    </div>
  </article>

  <!-- ğŸ–¼ï¸ Modal galerÃ­a -->
  <div id="modal" class="modal" aria-hidden="true" role="dialog" aria-label="Imagen ampliada">
    <button class="cerrar" id="modalClose" aria-label="Cerrar">âœ–ï¸</button>
    <img class="modal-contenido" id="img-ampliada" alt="Vista ampliada" />
    <div id="caption" class="muted" style="margin-top:.4rem"></div>
  </div>
</section>

<script>
/* ğŸ”§ Comportamiento de la pestaÃ±a Inicio (CÃ¡ritas) */
(() => {
  'use strict';

  // === GalerÃ­a con modal ===
  const modal      = document.getElementById('modal');
  const modalImg   = document.getElementById('img-ampliada');
  const modalClose = document.getElementById('modalClose');
  const caption    = document.getElementById('caption');

  if (modal && modalImg && modalClose) {
    document.querySelectorAll('.galeria-grid img').forEach(img => {
      img.addEventListener('click', () => {
        modal.style.display = 'flex';
        modal.setAttribute('aria-hidden','false');
        modalImg.src = img.src;
        caption.textContent = img.alt || '';
        modalImg.focus();
      });
    });
    modalClose.addEventListener('click', () => {
      modal.style.display='none';
      modal.setAttribute('aria-hidden','true');
    });
    modal.addEventListener('click', e => {
      if (e.target === modal) modalClose.click();
    });
    window.addEventListener('keydown', e => {
      if (e.key === 'Escape') modalClose.click();
    });
  }

  // === Pendientes (solo lectura) ===
  async function renderPendientesHome(){
    const tbody = document.getElementById('pendientesHomeBody');
    const empty = document.getElementById('pendientes-home-empty');
    if (!tbody || !window.CARITAS?.supabase) {
      empty?.removeAttribute("hidden");
      return;
    }
    tbody.innerHTML = '';
    try {
      const { data, error } = await window.CARITAS.supabase
        .from('pendientes')
        .select('descripcion, estado')
        .order('id', { ascending: true });
      if (error) throw error;

      if (!data || data.length === 0) {
        empty?.removeAttribute("hidden");
        return;
      }
      empty?.setAttribute("hidden","true");

      data.forEach(p => {
        const tr = document.createElement('tr');
        const safeText = (p.descripcion || '').replace(/[&<>"']/g,
          m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])
        );
        tr.innerHTML = `
          <td>${safeText} â¤ï¸</td>
          <td>${p.estado ? 'âœ”ï¸ Hecho' : 'â³ Pendiente'}</td>`;
        tbody.appendChild(tr);
      });
    } catch(err) {
      console.error('âŒ Error cargando pendientes:', err);
      empty?.removeAttribute("hidden");
      empty.textContent = "Error al cargar pendientes.";
    }
  }

  renderPendientesHome();
  document.dispatchEvent(new CustomEvent('caritas:inicio:ready'));
})();
</script>