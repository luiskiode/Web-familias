<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>🔑 Login — Cáritas CNC</title>

  <!-- Base para GitHub Pages -->
  <base href="/Web-familias/">

  <!-- Estilos globales -->
  <link rel="stylesheet" href="styles-caritas.css" />

  <!-- CSP segura -->
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self';
             script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://www.gstatic.com;
             style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://unpkg.com;
             img-src * data: blob:;
             connect-src *;
             font-src * data:;">

  <!-- Scripts de reparación / diagnóstico -->
  <script type="module" src="api.js/self-heal-caritas.js"></script>
  <script type="module" src="api.js/health-caritas.js"></script>
  <script defer src="api.js/error-overlay.js"></script>

  <!-- ✅ Firebase SDK (compat) -->
  <script defer src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <!-- Tu lógica de login -->
  <script defer src="api.js/firebase-config-caritas.js"></script>
  <script defer src="api.js/login.js"></script>
</head>
<body class="login-body">
  <!-- 🎥 Video de fondo -->
  <video id="video-fondo" autoplay muted loop>
    <source src="videos/fondo.mp4" type="video/mp4">
  </video> 

  <main class="login-wrap" role="main">
    <div class="login-card">
      <div class="brand">
        <span class="pin" title="Ir a inicio" onclick="location.href='index.html'">📌</span>
        <h1><b>Cáritas</b> CNC</h1>
      </div>
      <p class="sub">Inicia sesión para acceder a tu plataforma.</p>

      <form id="loginForm" autocomplete="on" novalidate>
        <label for="email">Correo</label>
        <input type="email" id="email" autocomplete="username" placeholder="tu@correo.com" required />
        <label for="password">Contraseña</label>
        <input type="password" id="password" autocomplete="current-password" placeholder="••••••••" required />
        <button type="submit" class="submit-btn">Ingresar</button>
      </form>

      <p id="loginMessage" role="alert" aria-live="polite"></p>

      <div class="row-actions">
        <button class="btn-ghost" id="resetPassBtn">¿Olvidaste tu contraseña?</button>
        <a class="btn-ghost" href="index.html">← Volver al inicio</a>
      </div>
    </div>
  </main>

  <script src="api.js/login.js"></script>
  <script>
  (()=>{
    'use strict';

    const form = document.getElementById('loginForm');
    const msg  = document.getElementById('loginMessage');
    const resetBtn = document.getElementById('resetPassBtn');

    function setMsg(text, type){
      msg.textContent = text || '';
      msg.classList.remove('error','success');
      if (type) msg.classList.add(type);
    }

    // Reset password
    resetBtn.addEventListener('click', async ()=>{
      const email = prompt('Ingresa tu correo para restablecer la contraseña:');
      if (!email) return;
      try{
        await window.CARITAS?.auth?.sendPasswordResetEmail(email);
        setMsg('📩 Si el correo existe, se envió un enlace de recuperación.','success');
      }catch(e){
        console.error(e);
        setMsg('❌ No se pudo enviar el correo.','error');
      }
    });
  })();
  </script>
</body>
</html>